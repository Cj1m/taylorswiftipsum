<html>
<head>
<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/main.css">

<link href='http://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Rock+Salt' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Hammersmith+One' rel='stylesheet' type='text/css'>

<script src="http://underscorejs.org/underscore.js"></script>
<!--
  /\___/\
 ( o   o )
 (  =^=  ) 
 (        )
 (         )
 (          )))))))))))
 taylorswiftipsum
-->
</head>
<body>
	
<div class="errorMessage"></div>

	<div class="snowContainer">
		<div id="lorem-forem">

			<form>
				<h1>Taylor Swift Ipsum</h1>

				Why be boring when you can be Taylor Swift? If you're working on a project & need some fun loreum ipsum placeholder text, you've come to the right place. Also, if you're bored & looking to entertain yourself this works too.
				<br /><br />

				<div class="gify-container">
					<div class="gify"></div>
				</div>

				Generate <input type="text" id="numberWords" placeholder="13"> words of Taylor Swift Ipsum.

				<br /><br />

				With lyrics from: 
				<div class="albumCheckBoxes">
				<input class="album hidden" type="checkbox" value="ts" checked>
				<label>
					<input class="album hidden" type="checkbox" value="nineteenEightyNine">
					<span class="album-title">1989</span>
				</label>
				<label>
					<input class="album hidden" type="checkbox" value="red">
					<span class="album-title">Red</span>
				</label>
				<label>
					<input class="album hidden" type="checkbox" value="speakNow">
					<span class="album-title">Speak Now</span>
				</label>
				<label>
					<input class="album hidden" type="checkbox" value="fearless">
					<span class="album-title">Fearless</span>
				</label>
				<label>
					<input class="album hidden" type="checkbox" value="taylorSwift">
					<span class="album-title">Taylor Swift</span>
				</label>
				</div>
				
				<br /><br />

				<input class="album" type="checkbox" value="hashtags"><label>Use Taylor's Tumblr #hashtags</label>

				<div id="lorem-submitum">Submit</div>

			</form>
		</div><!-- end lorem-forem -->

		<div id="lorem-result">
			Fill out the form above & hit the cat button to generate Taylor Swift Ipsum!
		</div>

		<div class="api-credits">
			<p>Taylor Swift Ipsum: A super fun experiment by Emily B. O'Brien</p>
			<br />
			<ul class="logos">
				<li>
					<img src="imgs/Giphy_API_Logo_ForWhite_Trans.gif" />
				</li>
				<li>
					 and
				</li>
				<li>
					<img src="imgs/tumblr_logotype_blue_28.png" />
				</li>
			</ul>
			<br />
			<p class="tumblr">This website uses the Tumblr application programming interface but is not endorsed or certified by Tumblr, Inc. All of the Tumblr logos and trademarks displayed on this [application/service] are the property of Tumblr, Inc.</p>
		</div>

	</div><!--end snowContainer-->

	<script type="text/javascript" src="js/lingo.js"></script><!-- our arrays -->
	<script>

		//EVENT LISTENERS
		document.getElementById('lorem-submitum').addEventListener('click', generateIpsum, false);
		document.getElementById('lorem-submitum').addEventListener('click', initEasterEggs, false);

		function getNumberWords(){
			var defaultNumber, inputNumber;

			defaultNumber = "13";
			inputNumber = $('#numberWords').val() || defaultNumber;

			if(inputNumber >= 500000){
				inputNumber = defaultNumber;
				showError('Trying to break me like a promise? Please choose a smaller number.');
			}
			if(inputNumber.match(/[^0-9]/g)){
				inputNumber = defaultNumber;
				showError('Please enter a numeric value');
			}

			return inputNumber;
		};

		function showError(errorText){
			$('.errorMessage').text(errorText)
				.css('display', 'block')
				.fadeOut(9000, 'linear');
		}

		function getAlbums(){
			var albums, combinedWords, allAlbums;

			albums = [];
			combinedWords = combinedWords || [];
			allAlbums = $('.album');

			//get all the album values that are checked
			for(var j = 0; j < allAlbums.length; j ++){
				if(allAlbums[j].checked === true){
					albums.push(allAlbums[j].value);
				}
			}

			//concat the selected arrays
			for(var i = 0; i < albums.length; i ++){
				//holder = (lingo[firstAlbum]).concat(lingo[albums[i]]);
				combinedWords = combinedWords.concat(lingo[albums[i]]);
			}

			return combinedWords;
		}
		
		function generateIpsum(){
			var storeWords, wordCount, combinedWords, finalWords, output, counter;
			
			// var start = new Date().getTime();
			// var elapsed;

			counter = 0;
			storeWords = [];
			wordCount = getNumberWords();
			combinedWords = getAlbums();

			while(counter < wordCount){
				//get a new random number each time within the range of the combinedWords array
				var randomNumber = Math.round(Math.random() * (combinedWords.length));
				var spaces = combinedWords[randomNumber].match(/\s/g) || []; //returns array of spaces
				counter = counter + (spaces.length + 1);
				storeWords.push(combinedWords[randomNumber]);
			}

			//combine storeWords into 1 string to split them by each word, lob off extra words
			finalWords = storeWords.join(' ').split(' ').splice(0, wordCount);
			//highlight the hashies
			highlightHashtags(finalWords);
			//add grammar
			output = addGrammar(wordCount, finalWords).join(' ');
			//display them
			displayWords('lorem-result', output);

			// elapsed = new Date().getTime() - start;
			// console.log('Time elapsed for generateIpsum: ', elapsed, 'with wordcount of: ', wordCount);
		}

		function highlightHashtags(textToParse){ //where textToParse is an array
			//TODO: add links?
			for(var z = 0; z < textToParse.length; z++){
				if(textToParse[z].match(/#\w+/g)){
					//TODO: fix this link situation
					textToParse[z] = '<a href="http://www.tumblr.com/' + textToParse[z] + '" ><span class="hashie">' + textToParse[z] + '</span></a>';
				}
			}
		}

		function addGrammar(wordCount, finalWords){
			wordCount = parseInt(wordCount);
			var counter = 0;

			while((counter >= 0) && (counter < (wordCount - 11))){
				var randomNumber = parseInt(getRandomNumberBtwn(5, 11));
				counter = counter + randomNumber; 
				//keep track of what index we're at and make sure it never gets bigger than the array length

				finalWords[counter] = finalWords[counter] + '.'; // add punctuation
				finalWords[counter + 1] = (finalWords[counter + 1].charAt(0).toUpperCase()) + (finalWords[counter + 1].slice(1));

				//capitalize next letter
				//TODO: if it's a hastag, capitalize the one after it
			}

			finalWords[0] = finalWords[0].charAt(0).toUpperCase() + finalWords[0].slice(1);
			return finalWords;
		}

		function getRandomNumberBtwn(min, max){
			var seed = Math.round(Math.random() * max);
			var result;

			if(seed < min){
				result = getRandomNumberBtwn(min, max);
			}
			else{
				result = seed;
			}

			return result;
		}

		function displayWords(id, words){
			var location = document.getElementById(id);
			location.innerHTML = words;
		}

 
 		//GIFY
		$.ajax({
        url: 'http://api.giphy.com/v1/gifs/search?q=taylor+Swift&limit=100&api_key=dc6zaTOxFJmzC',
        dataType: 'json',
        success: function(result){
        	//TODO: refactor this
        	var randomNumber = Math.round(Math.random() * result.data.length);
        	var gifUrl = result.data[randomNumber].images.fixed_height.url;
        	var gifWidth = result.data[randomNumber].images.fixed_height.width;
        	var gifHeight = result.data[randomNumber].images.fixed_height.height;

        	var containerWidth = (parseInt(gifWidth));
        	var containerHeight = (parseInt(gifHeight) + 50);
        	var calcMarginLeft = (containerWidth / 2) - (gifWidth / 2) + 'px';

        	var marginLeftGif = (parseInt(gifWidth) + 60) + 'px';

        	$('.gify-container').css('width', containerWidth);
        	$('.gify-container').css('height', containerHeight);

        	$('.gify').append($('<img>',{id:'gifyimg', src:gifUrl}));
        	$('#gifyimg').css('margin-left', calcMarginLeft);
        }
      });

	//TUMBLR HASHTAGS
	$.ajax({
        url: 'http://api.tumblr.com/v2/blog/taylorswift.tumblr.com/posts?api_key=lFtJkzttWGO9Gz1xH6isQNVPidE4xIVV5XqPqzMfTzeg6vfUMw',
        dataType: 'jsonp',
        success: function(result){

          var hashTagArray = [];

          	_.each(result.response.posts, function(post){
          		_.each(post.tags, function(tag){

          			hashTagArray.push('#' + tag);

          		});
          	});
          	window.lingo.hashtags = hashTagArray;

        }
      });



		//EASTER EGGS
		var easterEgg = easterEgg || {};

		function initEasterEggs(){
			easterEgg.counter = easterEgg.counter || 0;
			easterEgg.counter ++;

			if(easterEgg.counter % 13 === 0){
				$('.snowContainer').css('background-image', 'url("https://usatlife.files.wordpress.com/2014/08/everswifttumblrcom.gif?w=1000")');//https://usatlife.files.wordpress.com/2014/08/everswifttumblrcom.gif?w=1000
				$('.snowContainer').addClass('snowing');
			}
			if((easterEgg.counter > 13) && (easterEgg.counter % 13 === 1)){
				$('.snowContainer').removeClass('snowing');
				$('.snowContainer').css('background-image', '');
			}
		}

		function isChristmas(forcedValue){
			var today = new Date();

			easterEgg.xmas = forcedValue ? forcedValue : ((today.getMonth() === 11) && (today.getDay() === 25));

			christmasTheme();
		}

		function christmasTheme(){
			if(easterEgg.xmas === true){
				$('h1').append('<img class="xmashat" src="imgs/xmashat.png" />');
				$('.albumCheckBoxes').append('<label id="christmasAlbum" class="hidden"><input class="album hidden" type="checkbox" value="soundsoftheseason"><span class="album-title">Sounds Of The Season</span></label>');
				$('#christmasAlbum').fadeIn(2000);
			}
			else{
				console.log('It\'s not christmas. Bummer.');
			}
		}
	</script>

</body>
</html>
