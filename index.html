<html>
<head>
<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/main.css">

<link href='http://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Titillium+Web:600' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Rock+Salt' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Hammersmith+One' rel='stylesheet' type='text/css'>

<script src="http://underscorejs.org/underscore.js"></script>
<!--
  /\___/\
 ( o   o )
 (  =^=  ) 
 (        )
 (         )
 (          )))))))))))
 taylorswiftipsum
-->
</head>
<body>
	
<div class="errorMessage"></div>

	<div class="snowContainer">

			<div id="lorem-result">
				<div class="gify-container">
					<div class="gify"></div>
				</div>
				<span class="loading">Loading...</span>
				<div id="outputWords"></div>
			</div>

		<div id="lorem-forem">

			<form>
				<h1>Taylor Swift Ipsum</h1>

				<span class="intro-text">Why be boring when you can be Taylor Swift? If you're working on a project & need some fun loreum ipsum placeholder text, you've come to the right place. Also, if you're bored & looking to entertain yourself this works too.</span>
				<br /><br />

				<div class="form-text">

					<div class="form-left">
						<h3>Word Count</h3>
						Generate <input type="text" id="numberWords" placeholder="130"> words of Taylor Swift Ipsum

						<br /><br />
					
						<h3>Hashtags</h3>
						<input class="album" type="checkbox" value="hashtags"><label>Use hashtags from taylorswift.tumblr.com</label>
					</div><!-- end form-left -->

					<div class="form-right">
						<h3>Lyrics</h3>
						Include lyrics from the following albums:
						<br />

						<div class="albumCheckBoxes">
							<input class="album hidden" type="checkbox" value="ts" checked>
							<label>
								<input class="album hidden" type="checkbox" value="nineteenEightyNine">
								<span class="album-title">1989</span>
							</label>
							<label>
								<input class="album hidden" type="checkbox" value="red">
								<span class="album-title">Red</span>
							</label>
							<label>
								<input class="album hidden" type="checkbox" value="speakNow">
								<span class="album-title">Speak Now</span>
							</label>
							<label>
								<input class="album hidden" type="checkbox" value="fearless">
								<span class="album-title">Fearless</span>
							</label>
							<label>
								<input class="album hidden" type="checkbox" value="taylorSwift">
								<span class="album-title">Taylor Swift</span>
							</label>
						</div><!-- end albumCheckBoxes -->
					</div><!-- end form-right -->
				</div><!-- end form-text -->

				<div id="lorem-submitum">Submit</div>

			</form>
		</div><!-- end lorem-forem -->

		<div class="api-credits">
			<p>Taylor Swift Ipsum: A super fun experiment by Emily B. O'Brien</p>
			<br />
			<ul class="logos">
				<li>
					<img src="imgs/Giphy_API_Logo_ForWhite_Trans.gif" />
				</li>
				<li>
					 and
				</li>
				<li>
					<img src="imgs/tumblr_logotype_blue_28.png" />
				</li>
			</ul>
			<br />
			<p class="tumblr">This website uses the Tumblr application programming interface but is not endorsed or certified by Tumblr, Inc. All of the Tumblr logos and trademarks displayed on this [application/service] are the property of Tumblr, Inc.</p>
		</div>

	</div><!--end snowContainer-->

	<script type="text/javascript" src="js/lingo.js"></script><!-- our arrays -->
	<script>

		//EVENT LISTENERS
		document.getElementById('lorem-submitum').addEventListener('click', generateIpsum, false);
		document.getElementById('lorem-submitum').addEventListener('click', hideCurrentWords, false);
		document.getElementById('lorem-submitum').addEventListener('click', initEasterEggs, false);

		function getNumberWords(){
			var defaultNumber, inputNumber;

			defaultNumber = "130";
			inputNumber = $('#numberWords').val() || defaultNumber;

			if(inputNumber >= 500000){
				inputNumber = defaultNumber;
				showError('Trying to break me like a promise? Please choose a smaller number.');
			}
			if(inputNumber.match(/[^0-9]/g)){
				inputNumber = defaultNumber;
				showError('Please enter a numeric value');
			}

			return inputNumber;
		};

		function showError(errorText){
			$('.errorMessage').text(errorText)
				.css('display', 'block')
				.fadeOut(9000, 'linear');
		}

		function getAlbums(){
			var albums, combinedWords, allAlbums;

			albums = [];
			combinedWords = combinedWords || [];
			allAlbums = $('.album');

			//get all the album values that are checked
			for(var j = 0; j < allAlbums.length; j ++){
				if(allAlbums[j].checked === true){
					albums.push(allAlbums[j].value);
				}
			}

			//concat the selected arrays
			for(var i = 0; i < albums.length; i ++){
				combinedWords = combinedWords.concat(lingo[albums[i]]);
			}

			return combinedWords;
		}
		
		function generateIpsum(){
			var storeWords, wordCount, combinedWords, finalWords, output, counter;

			counter = 0;
			storeWords = [];
			wordCount = getNumberWords();
			combinedWords = getAlbums();

			while(counter <= wordCount){
				//get a new random number each time within the range of the combinedWords array
				var randomNumber = Math.round(Math.random() * (combinedWords.length - 1));

				var spaces = combinedWords[randomNumber].match(/\s/g) || [];
				counter = counter + (spaces.length + 1);
				storeWords.push(combinedWords[randomNumber]);
			}

			//combine storeWords into 1 string to split them by each word, lob off extra words
			finalWords = storeWords.join(' ').split(' ').splice(0, wordCount);
			//highlight the hashies
			//highlightHashtags(finalWords);
			//add grammar
			output = addGrammar(wordCount, finalWords).join(' ');
			//display them
			displayWords('outputWords', output);

			$("html, body").animate({ scrollTop: 0 }, "slow");

			showHideGiphy();
			//fade in text box
		}

		function showHideGiphy(){
			var resultBox = $('#lorem-result');
			var gif = $('.gify-container');
			var loading = $('.loading');

			if(resultBox.css('display') === 'none'){
				resultBox.css('display', 'block');
				resultBox.animate({height: 300}, 'slow'); //figure out this height
				gif.css('display', 'block');
			}
			else{
				gif.css('display', 'block');
			}
			//Remove and replace
			setTimeout(function(){
				gif.fadeOut('slow', function(){
					resultBox.css('height', 'auto');
					displayWordContainer(); //display the text
					changeCopy('So fun right? Want to try again with different selections? No problem - just fill out the form below & click the submit button again for another round of Taylor Swift Ipsum.');
				});
				loading.fadeOut('slow');
			}, 2000);
		}

		function changeCopy(copy){
			if(!$('.intro-text').hasClass('updated')){
				$('.intro-text').fadeOut('fast', function(){
				$('.intro-text').text(copy)
					.fadeIn()
					.addClass('updated');
				})
			}
			else{
				return;
			}
		}

		function displayWordContainer(){
			$('#outputWords').fadeIn();
		}

		function hideCurrentWords(){
			if($('#outputWords').css('display') === 'block'){
				$('#outputWords').css('display', 'none');//fade out then scroll to top?
			}
			else{
				return;
			}
		}


		function addGrammar(wordCount, finalWords){
			wordCount = parseInt(wordCount);
			var counter = 0;

			while((counter >= 0) && (counter < (wordCount - 11))){
				var randomNumber = parseInt(getRandomNumberBtwn(5, 11));
				counter = counter + randomNumber; 
				//keep track of what index we're at and make sure it never gets bigger than the array length

				finalWords[counter] = finalWords[counter] + '.'; // add punctuation
				finalWords[counter + 1] = (finalWords[counter + 1].charAt(0).toUpperCase()) + (finalWords[counter + 1].slice(1));

				//capitalize next letter
				//TODO: if it's a hastag, capitalize the one after it
			}

			finalWords[0] = finalWords[0].charAt(0).toUpperCase() + finalWords[0].slice(1);
			return finalWords;
		}

		function getRandomNumberBtwn(min, max){
			var seed = Math.round(Math.random() * max);
			var result;

			if(seed < min){
				result = getRandomNumberBtwn(min, max);
			}
			else{
				result = seed;
			}
			return result;
		}

		function displayWords(id, words){
			var location = document.getElementById(id);
			location.innerHTML = words;
		}
 
 		//GIPHY
		$.ajax({
        url: 'http://api.giphy.com/v1/gifs/search?q=blank+space&limit=100&api_key=12PnkylgHYUVgs',
        dataType: 'json',
        success: function(result){
        	//TODO: refactor this
        	var randomNumber = Math.round(Math.random() * result.data.length);
        	var gifUrl = result.data[randomNumber].images.fixed_height.url;
        	var gifWidth = result.data[randomNumber].images.fixed_height.width;
        	var gifHeight = result.data[randomNumber].images.fixed_height.height;

        	var containerWidth = (parseInt(gifWidth));
        	var containerHeight = (parseInt(gifHeight) + 50);
        	var calcMarginLeft = (containerWidth / 2) - (gifWidth / 2) + 'px';

        	var marginLeftGif = (parseInt(gifWidth) + 60) + 'px';

        	$('.gify-container').css('width', containerWidth);
        	$('.gify-container').css('height', containerHeight);

        	$('.gify').append($('<img>',{id:'gifyimg', src:gifUrl}));
        	$('#gifyimg').css('margin-left', calcMarginLeft);
        }
      });

	//TUMBLR HASHTAGS
	$.ajax({
        url: 'http://api.tumblr.com/v2/blog/taylorswift.tumblr.com/posts?api_key=lFtJkzttWGO9Gz1xH6isQNVPidE4xIVV5XqPqzMfTzeg6vfUMw',
        dataType: 'jsonp',
        success: function(result){

          var hashTagArray = [];

          	_.each(result.response.posts, function(post){
          		_.each(post.tags, function(tag){

          			hashTagArray.push('#' + tag);

          		});
          	});
          	window.lingo.hashtags = hashTagArray;

        }
      });

		//EASTER EGGS
		var easterEgg = easterEgg || {};

		function initEasterEggs(){
			easterEgg.counter = easterEgg.counter || 0;
			easterEgg.counter ++;

			if(easterEgg.counter % 13 === 0){
				$('.snowContainer').css('background-image', 'url("https://usatlife.files.wordpress.com/2014/08/everswifttumblrcom.gif?w=1000")');//https://usatlife.files.wordpress.com/2014/08/everswifttumblrcom.gif?w=1000
				$('.snowContainer').addClass('snowing');
			}
			if((easterEgg.counter > 13) && (easterEgg.counter % 13 === 1)){
				$('.snowContainer').removeClass('snowing');
				$('.snowContainer').css('background-image', '');
			}
		}

		function isChristmas(forcedValue){
			var today = new Date();

			easterEgg.xmas = forcedValue ? forcedValue : ((today.getMonth() === 11) && (today.getDay() === 25));

			christmasTheme();
		}

		function christmasTheme(){
			if(easterEgg.xmas === true){
				$('h1').append('<img class="xmashat" src="imgs/xmashat.png" />');
				$('.albumCheckBoxes').append('<label id="christmasAlbum" class="hidden"><input class="album hidden" type="checkbox" value="soundsoftheseason"><span class="album-title">Sounds Of The Season</span></label>');
				$('#christmasAlbum').fadeIn(2000);
			}
			else{
				console.log('It\'s not christmas. Bummer.');
			}
		}
	</script>

</body>
</html>
